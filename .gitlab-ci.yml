# étapes du CI/CD (on choisit le nom)
stages:
  - "Build"
  - "Test"
  - "Code Quality"
  - "Docker"
  - "Deploy"
services:
  - docker:dind

# liste des étapes
Build:
  tags:
    - "node"
  stage: "Build" # renseignement de l'étape au niveau du pipeline
  image: node # image docker a utiliser
  script: # scripts a lancer
    - npm install
    - npm run build


Integration:
  tags:
    - "node"
  stage: "Test"
  image: node
  script:
    - echo "Will fail because of Karma"
  allow_failure: true

Sonar:
  tags:
    - "node"
  stage: "Test"
  image: node
  script: echo "No sonar config yet"
  allow_failure: true

Docker_push:
  tags:
    - "docker"
  stage: "Docker"
  script:
    - docker login -u "$CI_REGISTRY_USER" -p "$CI_REGISTRY_PASSWORD"
    - docker build -t benoitsemifir/demo-angular .
    - docker push benoitsemifir/demo-angular

Azure_Deploy:
  stage: "Deploy"
  image: dind
  script:
    - echo "No deployment yet"